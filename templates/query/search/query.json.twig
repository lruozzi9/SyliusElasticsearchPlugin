{% set searchTerm = searchTerm|json_encode %}
{
    "bool": {
        "filter": [
            {
                "term": {
                    "enabled": true
                }
            }
            {% for filterType, filters in filters %}
                {% if filters|length > 0 %}
                    ,{% include '@WebgriffeSyliusElasticsearchPlugin/query/search/search/' ~ filterType ~ '.json.twig' %}
                {% endif %}
            {% endfor %}{% block extra_filter_fields %}{% endblock %}
        ],
        "should": [
            {
                "term": {
                    "code": {{ searchTerm|raw }}
                }
            },
            {
                "nested": {
                    "path": "variants",
                    "query": {
                        "term": {
                            "variants.code": {{ searchTerm|raw }}
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "name",
                    "query": {
                        "match": {
                            {{ ('name.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 10,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "variants",
                    "query": {
                        "match": {
                            {{ ('variants.name.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 9,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "description",
                    "query": {
                        "match": {
                            {{ ('description.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 8,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "short-description",
                    "query": {
                        "match": {
                            {{ ('short-description.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 7,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "slug",
                    "query": {
                        "match": {
                            {{ ('slug.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 6,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "meta-description",
                    "query": {
                        "match": {
                            {{ ('meta-description.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 5,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "meta-keywords",
                    "query": {
                        "match": {
                            {{ ('meta-keywords.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 4,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "taxons",
                    "query": {
                        "match": {
                            {{ ('taxons.name.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 3,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "translated-attributes",
                    "query": {
                        "match": {
                            {{ ('translated-attributes.values.' ~ localeCode ~ '.text-value')|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 3,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "attributes",
                    "query": {
                        "match": {
                            "attributes.values.text-value": {
                                "query": {{ searchTerm|raw }},
                                "boost": 3,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            },
            {
                "nested": {
                    "path": "product-options",
                    "query": {
                        "match": {
                            {{ ('product-options.values.name.' ~ localeCode)|json_encode|raw }}: {
                                "query": {{ searchTerm|raw }},
                                "boost": 3,
                                "fuzziness": "AUTO",
                                "fuzzy_transpositions": true,
                                "operator": "OR"
                            }
                        }
                    }
                }
            }{% block extra_should_fields %}{% endblock %}
        ]
    }
}
