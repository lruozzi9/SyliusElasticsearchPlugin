{
    "{{ attribute.code }}": {
        "nested": {
            "path": "attributes"
        },
        "aggs": {
            "filter_by_key": {
                "filter": {
                    "bool": {
                        "filter": [
                            {
                                "term": {
                                    "attributes.code": "{{ attribute.code }}"
                                }
                            }
                        ]
                    }
                },
                "aggs": {
                    "values": {
                        "terms": {
                            "field": "attributes.values.text-value"
                        }
                    },
                    "name": {
                        "nested": {
                            "path": "attributes.name"
                        },
                        "aggs": {
                            "filter_name_by_locale": {
                                "filter": {
                                    "bool": {
                                        "filter": [
                                            {
                                                "term": {
                                                    "attributes.name.locale": "{{ localeCode|lower }}"
                                                }
                                            }
                                        ]
                                    }
                                },
                                "aggs": {
                                    "values": {
                                        "terms": {
                                            "field": "attributes.name.value"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "meta": {
            "type": "{{ constant('\\Webgriffe\\SyliusElasticsearchPlugin\\Model\\AttributeFilter::TYPE') }}"
        }
    }
}
